var _util = OT2.Util;
OT2.Global = {
    initPage: function() {
        this.goTop(), this.searchMenu(), this.topNavMenu(), this.topheadMenu(), this.toggleSearchTypes();
        var t = this;
        $(function() {
            t.strcut(), "function" == typeof user_news && user_news()
        })
    },
    goTop: function(t) {
        var i = 1200;
        "undefined" != typeof SIZE && (i = "XL" == SIZE ? 1200 : 1e3);
        var n = t,
            o = function() {
                var t = $(window).width();
                if (t > i) {
                    var o = (t - i) / 2 - 70;
                    n.css("right", o + "px")
                }
            };
        n || (n = $('<a class="return" href="javascript:;"><i class="icona-top"></i></a>'), n.appendTo(document.body), o()), n.on("click", function() {
            n.hide(), "undefined" == typeof window.dispatchEvent ? $("html, body").scrollTop(0) : $("html, body").animate({
                scrollTop: 0
            }, "fast")
        });
        var e = $(window).height();
        $(window).on("scroll", function() {
            H = Math.max.call(null, document.documentElement.scrollTop, document.body.scrollTop), n[H > e / 2 ? "show" : "hide"]()
        }), $(window).on("resize", o)
    },
    searchMenu: function() {
        var t = $("#J_SearchMenu"),
            i = t.find(".select-items"),
            n = t.find(".J_tit");
        t.hover(function() {
            i.show()
        }, function() {
            i.hide()
        }), t.on("click", "a", function() {
            var t = $(this);
            t.find("input").prop("checked", !0);
            var o = $.trim(t.find("input").val());
            o = 0 === o.indexOf("/") ? o : "/" + o, t.parents().find("form").attr({
                action: o
            });
            var e = t.find("span").text();
            n.text(e), i.hide()
        })
    },
    topNavMenu: function() {
        var t = $(".nav-items"),
            i = t.find(".item-list");
        _util.dropList(t, i, 500)
    },
    topheadMenu: function() {
        var t = $(".topbar-dropmap");
        t.each(function() {
            var t = $(this).find(".drop-bd");
            _util.dropList($(this), t, 300)
        })
    },
    toggleSearchTypes: function() {
        var t = $('<span class="show-more">更多<i></i></span>'),
            i = 40,
            n = function(n) {
                var o = $(n),
                    e = o.hasClass("expand-mode"),
                    s = o.find(".con-items").height();
                if (s <= i) return !0;
                var r = t.clone().appendTo(n);
                r.on("click", function() {
                    e = !e, o[e ? "addClass" : "removeClass"]("expand-mode")
                });
                var a = o.find(".type-active").position();
                a.top > 5 && !e && r.trigger("click")
            };
        $(".search-type").find("div.type-con").each(function() {
            n(this)
        }), $(".tag-type").find("div.tag-con").each(function() {
            n(this)
        })
    },
    strcut: function() {
        $("[data-cut]").each(function() {
            var t = parseInt($(this).data("cut"), 10),
                i = $(this).text();
            i.length > t && ($(this).text(i.substr(0, t) + "..."), $(this).attr("title", i))
        })
    },
    initLogin: function(t) {
        return "undefined" != typeof USER.uid && 0 != USER.uid ? !t || (window.location = t, !1) : "undefined" != typeof this.LoginModal ? (this.LoginModal.formObj.clearError(), this.LoginModal.show(t), !1) : (this.LoginModal = {
            init: function() {
                var t = this;
                return this.$el = $("#Login_Pal"), this.$form = this.$el.find(".reg-form").first(), OT2.UserForm.initPlaceholder(), this.formObj = new OT2.UserForm.Login, this.formObj.$form = this.$el.find("#J_LoginForm"), this.formObj.init(), this.$form.find(".checkbox").each(function() {
                    new OT2.Element.checkbox(this).bindEvent()
                }), this.$form.find(".J_CloseForm").on("click", function() {
                    t.$el.hide()
                }), this
            },
            show: function(t) {
                this.$el.show();
                var i = document.body.scrollTop || document.documentElement.scrollTop,
                    n = ($(window).height() - this.$form.height()) / 2;
                this.$form.css("top", i + n), this.formObj.returnurl = t
            }
        }, this.LoginModal.init().show(t), !1)
    }
}, OT2.Global.initPage();